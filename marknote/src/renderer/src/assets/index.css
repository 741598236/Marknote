@tailwind base;
@tailwind components;
@tailwind utilities;

@layer base {
  #root {
    @apply h-full;
  }

  html,
  body {
    @apply h-full;
    @apply select-none;
    @apply bg-transparent;
    @apply font-mono antialiased;
    @apply overflow-hidden;
    /* 优化亮色/暗色模式对比度 */
    @apply text-gray-900 bg-[#f9f8f6]; /* 更柔和的暖白背景 */
    /* 优化暗黑模式 */
    @apply dark:text-gray-50 dark:bg-[#1a1816];
    /* 统一过渡效果 */
    @apply transition-all duration-300 ease-smooth;
  }

  /* 优化滚动条样式 */
  ::-webkit-scrollbar {
    @apply w-2.5 h-2.5;
  }
  ::-webkit-scrollbar-track {
    @apply bg-gray-50/50 dark:bg-gray-900/50 rounded-full;
  }
  ::-webkit-scrollbar-thumb {
    @apply bg-gray-400/80 dark:bg-gray-500/80 rounded-full;
    @apply transition-all duration-200;
  }
  ::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-500 dark:bg-gray-400;
    @apply w-3;
  }

  /* 表单元素样式 */
  input,
  textarea,
  select {
    @apply bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100;
    @apply border border-gray-300 dark:border-gray-600;
    @apply rounded-lg;
    @apply px-4 py-2.5;
    @apply transition-all duration-300 ease-smooth;
    @apply hover:border-gray-400 dark:hover:border-gray-500;
    @apply focus:ring-2 focus:ring-blue-500/30 focus:border-blue-500;
  }

  /* 链接样式 */
  a {
    @apply text-blue-600 dark:text-blue-400;
    @apply hover:text-blue-800 dark:hover:text-blue-300;
    @apply transition-colors duration-300 ease-smooth;
    @apply hover:underline hover:underline-offset-4;
  }
}

@layer components {
  /* 笔记预览列表项 */
  .note-preview {
    @apply p-3 rounded-xl;
    @apply transition-all duration-300 ease-smooth;
    @apply hover:scale-[1.02] hover:shadow-md;
    @apply active:scale-95;
    @apply cursor-pointer;
    @apply mb-2 last:mb-0; /* 优化行间距 */
  }

  /* 暗黑模式切换滑块 */
  .theme-toggle {
    @apply relative inline-flex h-6 w-11 items-center rounded-full;
    @apply bg-gray-200 dark:bg-gray-700;
    @apply transition-all duration-300 ease-smooth;
    @apply hover:bg-gray-300 dark:hover:bg-gray-600;
  }

  .theme-toggle__thumb {
    @apply inline-block h-5 w-5 rounded-full bg-white shadow-lg;
    @apply transform transition-transform duration-300;
    @apply flex items-center justify-center;
    @apply text-sm leading-none; /* 控制图标大小 */
  }

  /* 激活状态 */
  .theme-toggle--active {
    @apply bg-blue-500;
  }

  .theme-toggle--active .theme-toggle__thumb {
    @apply translate-x-5;
  }

  /* 顶部标题栏 */
  .top-bar {
    @apply h-12 bg-gray-100 dark:bg-gray-800;
    @apply border-b border-gray-200 dark:border-gray-700;
    @apply sticky top-0 z-50;
  }

  /* 侧边栏 */
  .sidebar {
    @apply w-56 bg-white dark:bg-gray-800;
    @apply border-r-4 border-red-500 dark:border-red-700;
    @apply overflow-y-auto;
    @apply p-4 space-y-3; /* 增加内边距和元素间距 */
  }

  /* 内容区域 */
  .content-area {
    @apply flex-1 bg-white dark:bg-gray-800;
    @apply border-4 border-blue-500 dark:border-blue-700;
    @apply overflow-auto;
    @apply p-6; /* 增加内边距 */
  }

  /* 修复对话框定位问题 - 确保弹窗在正确位置显示 */
  .link-dialog-anchor,
  [class*="_linkDialogAnchor_"],
  [class*="_linkDialogPopoverContent_"],
  [class*="_dialogContent_"] {
    position: fixed !important;
    inset: 50% auto auto 50% !important;
    transform: translate(-50%, -50%) !important;
    z-index: 9999 !important;
    max-height: 80vh !important;
    max-width: 90vw !important;
    margin: 0 !important;
  }

  /* 确保对话框内容可见且不被遮挡 */
  .link-dialog-popover-content,
  [class*="_linkDialogPopoverContent_"] {
    z-index: 10000 !important;
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
  }

  .dialog-content,
  [class*="_dialogContent_"] {
    z-index: 10000 !important;
    position: fixed !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
  }

  /* 确保父容器不会影响fixed定位 */
  #root,
  .h-full,
  .flex-1,
  .flex-col {
    transform: none !important;
    filter: none !important;
    perspective: none !important;
  }

  /* 禁用对话框背景遮罩效果 */
  [class*="_dialogOverlay_"],
  .dialog-overlay,
  ._dialogOverlay_sects_870 {
    display: none !important;
    opacity: 0 !important;
    background-color: transparent !important;
    visibility: hidden !important;
  }

  /* 确保对话框没有背景遮罩 */
  [data-radix-dialog-overlay],
  [role="dialog"] + [class*="overlay"] {
    display: none !important;
  }

  /* 强制隐藏所有可能的背景遮罩 */
  .radix-dialog-overlay,
  [data-state="open"] + [class*="overlay"],
  [data-dialog-overlay],
  .mdxeditor-dialog-overlay {
    display: none !important;
    opacity: 0 !important;
    background: transparent !important;
    pointer-events: none !important;
  }

  /* 超强制定位修复 - 针对表格行菜单按钮 */
  /* 强制所有表格工具单元格内的按钮绝对居中 */
  ._tableEditor_sects_714 th[data-tool-cell="true"],
  ._tableEditor_sects_714 td[data-tool-cell="true"] {
    position: relative !important;
    width: 2rem !important;
    min-width: 2rem !important;
    max-width: 2rem !important;
    text-align: center !important;
    vertical-align: middle !important;
    padding: 0 !important;
    margin: 0 !important;
  }

  /* 强制行菜单按钮在所有行中居中 */
  ._tableEditor_sects_714 tbody tr th[data-tool-cell="true"] > button,
  ._tableEditor_sects_714 tbody tr td[data-tool-cell="true"] > button,
  ._tableEditor_sects_714 ._toolCell_sects_725 > button {
    position: absolute !important;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) !important;
    margin: 0 !important;
    padding: 0.25rem !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    width: auto !important;
    min-width: auto !important;
    max-width: none !important;
  }

  /* 覆盖所有可能的行菜单按钮样式 */
  ._tableEditor_sects_714 ._tableRowEditorTrigger_sects_745,
  ._tableEditor_sects_714 ._tableColumnEditorTrigger_sects_744 {
    position: absolute !important;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) !important;
    margin: 0 !important;
    right: auto !important;
    bottom: auto !important;
  }

  /* 确保表格容器不会影响定位 */
  ._tableEditor_sects_714 {
    position: relative !important;
    border-collapse: separate !important;
    border-spacing: 0 !important;
  }

  /* 修复表格行高度一致性 */
  ._tableEditor_sects_714 tbody tr {
    height: 3.5rem !important;
    min-height: 3.5rem !important;
    vertical-align: middle !important;
  }

  /* 强制覆盖所有行中的按钮位置 */
  ._tableEditor_sects_714 tbody tr:nth-child(1) th[data-tool-cell="true"] > button,
  ._tableEditor_sects_714 tbody tr:nth-child(2) th[data-tool-cell="true"] > button,
  ._tableEditor_sects_714 tbody tr:nth-child(3) th[data-tool-cell="true"] > button,
  ._tableEditor_sects_714 tbody tr:nth-child(n) th[data-tool-cell="true"] > button {
    position: absolute !important;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) !important;
    margin: 0 !important;
  }

  /* 使用更具体的选择器覆盖MDXEditor的样式 */
  ._tableEditor_sects_714 ._tableRowEditorTrigger_sects_745[data-radix-popover-trigger] {
    position: absolute !important;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) !important;
    margin: 0 !important;
    right: auto !important;
    bottom: auto !important;
  }

  /* 针对Radix Popover的特殊修复 */
  [data-radix-popover-trigger] {
    position: absolute !important;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) !important;
    margin: 0 !important;
  }

  /* 修复工具单元格内的按钮位置 */
  ._toolCell_sects_725 [data-radix-popover-trigger] {
    position: absolute !important;
    left: 50% !important;
    top: 50% !important;
    transform: translate(-50%, -50%) !important;
    margin: 0 !important;
  }

  /* 拖拽模式样式 */
  .drag-mode-active .prose > * {
    position: relative;
    cursor: move;
    transition: all 0.2s ease;
    border-left: 3px solid transparent;
    margin: 1rem 0;
    padding: 0.5rem 0 0.5rem 1rem;
  }
  
  .drag-mode-active .prose > *:hover {
    border-left-color: #3b82f6;
    background-color: rgba(59, 130, 246, 0.1);
  }
  
  .drag-mode-active .prose > *.dragging {
    opacity: 0.5;
    transform: rotate(2deg);
  }
  
  .drag-mode-active .prose > *.drag-over {
    border-left-color: #1d4ed8;
    border-left-width: 4px;
    background-color: rgba(29, 78, 216, 0.15);
  }
  
  .drag-mode-active .prose > *::before {
    content: "⋮⋮";
    position: absolute;
    left: -1.5rem;
    top: 50%;
    transform: translateY(-50%);
    color: #9ca3af;
    font-size: 0.875rem;
    cursor: grab;
    opacity: 0;
    transition: opacity 0.2s ease;
  }
  
  .drag-mode-active .prose > *:hover::before {
    opacity: 1;
    color: #3b82f6;
  }
  
  .drag-mode-active .prose > *.dragging::before {
    cursor: grabbing;
    opacity: 1;
  }

  /* 拖拽模式下的代码块特殊处理 */
  .drag-mode-active .prose pre {
    cursor: move;
  }
  
  .drag-mode-active .prose pre::before {
    left: -2rem;
  }

  /* 拖拽模式下的表格特殊处理 */
  .drag-mode-active .prose table {
    cursor: move;
  }
}
